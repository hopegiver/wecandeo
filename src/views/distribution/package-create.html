<!-- 배포 패키지 생성/편집 -->
<div class="container-fluid py-4">
    <!-- 헤더 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">{{isEditMode ? '패키지 편집' : '새 패키지 만들기'}}</h2>
            <p class="text-muted mb-0">동영상을 묶어서 배포 설정과 함께 관리합니다</p>
        </div>
        <button class="btn btn-outline-secondary" @click="goBack">
            <i class="bi bi-arrow-left"></i> 목록으로
        </button>
    </div>

    <form @submit.prevent="savePackage">
        <div class="row">
            <!-- 왼쪽: 기본 정보 및 동영상 선택 -->
            <div class="col-lg-8">
                <!-- 기본 정보 -->
                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">기본 정보</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">패키지 이름 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" v-model="form.name"
                                   placeholder="예: 신제품 홍보 패키지" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">설명</label>
                            <textarea class="form-control" rows="3" v-model="form.description"
                                      placeholder="패키지에 대한 간단한 설명을 입력하세요"></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">카테고리</label>
                            <select class="form-select" v-model="form.category">
                                <option value="">카테고리 선택</option>
                                <option value="marketing">마케팅</option>
                                <option value="training">교육/트레이닝</option>
                                <option value="event">이벤트</option>
                                <option value="product">제품 소개</option>
                                <option value="internal">내부 자료</option>
                                <option value="other">기타</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 동영상 선택 -->
                <div class="card mb-4">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">동영상 선택</h5>
                        <button type="button" class="btn btn-sm btn-primary" @click="showVideoSelector">
                            <i class="bi bi-plus-lg"></i> 동영상 추가
                        </button>
                    </div>
                    <div class="card-body">
                        <div v-if="form.videos.length === 0" class="text-center py-5 text-muted">
                            <i class="bi bi-film fs-1 d-block mb-3"></i>
                            <p class="mb-0">동영상을 추가해주세요</p>
                        </div>

                        <div v-else class="list-group list-group-flush">
                            <div v-for="(video, index) in form.videos" :key="video.id"
                                 class="list-group-item px-0">
                                <div class="d-flex align-items-center">
                                    <div class="flex-shrink-0 me-2">
                                        <i class="bi bi-grip-vertical text-muted" style="cursor: move"></i>
                                    </div>
                                    <div class="flex-shrink-0">
                                        <img :src="video.thumbnail" class="rounded"
                                             style="width: 80px; height: 60px; object-fit: cover"
                                             :alt="video.title">
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <div class="fw-semibold">{{video.title}}</div>
                                        <div class="small text-muted">{{video.duration}} · {{video.views | number}} 조회</div>
                                    </div>
                                    <div class="flex-shrink-0">
                                        <button type="button" class="btn btn-sm btn-outline-danger"
                                                @click="removeVideo(index)">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-if="form.videos.length > 0" class="mt-3 text-muted small">
                            <i class="bi bi-info-circle"></i> 드래그하여 순서를 변경할 수 있습니다
                        </div>
                    </div>
                </div>

                <!-- 배포 설정 -->
                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">배포 설정</h5>
                    </div>
                    <div class="card-body">
                        <!-- 템플릿 빠른 적용 -->
                        <div class="alert alert-info mb-4">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-lightbulb me-2"></i>
                                <strong>빠른 설정</strong>
                            </div>
                            <div class="btn-group btn-group-sm">
                                <button type="button" class="btn btn-outline-primary"
                                        @click="applyTemplate('public')">
                                    <i class="bi bi-globe"></i> 공개용
                                </button>
                                <button type="button" class="btn btn-outline-secondary"
                                        @click="applyTemplate('internal')">
                                    <i class="bi bi-building"></i> 내부용
                                </button>
                                <button type="button" class="btn btn-outline-warning"
                                        @click="applyTemplate('partner')">
                                    <i class="bi bi-people"></i> 파트너용
                                </button>
                            </div>
                        </div>

                        <!-- 공개 범위 -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                <i class="bi bi-shield-check text-primary"></i> 공개 범위
                            </label>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="form-check card p-3" :class="{'border-primary': form.settings.visibility === 'public'}">
                                        <input class="form-check-input" type="radio" name="visibility"
                                               id="visibility-public" value="public" v-model="form.settings.visibility">
                                        <label class="form-check-label" for="visibility-public">
                                            <i class="bi bi-globe text-success"></i> <strong>완전 공개</strong>
                                            <div class="small text-muted mt-1">누구나 검색하고 볼 수 있음</div>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check card p-3" :class="{'border-primary': form.settings.visibility === 'unlisted'}">
                                        <input class="form-check-input" type="radio" name="visibility"
                                               id="visibility-unlisted" value="unlisted" v-model="form.settings.visibility">
                                        <label class="form-check-label" for="visibility-unlisted">
                                            <i class="bi bi-link-45deg text-warning"></i> <strong>링크만 공유</strong>
                                            <div class="small text-muted mt-1">링크를 아는 사람만 시청</div>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check card p-3" :class="{'border-primary': form.settings.visibility === 'private'}">
                                        <input class="form-check-input" type="radio" name="visibility"
                                               id="visibility-private" value="private" v-model="form.settings.visibility">
                                        <label class="form-check-label" for="visibility-private">
                                            <i class="bi bi-lock text-secondary"></i> <strong>비공개</strong>
                                            <div class="small text-muted mt-1">인증된 사용자만 시청</div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- 도메인 제한 -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                <i class="bi bi-link-45deg text-primary"></i> 도메인 제한
                            </label>
                            <input type="text" class="form-control" v-model="form.settings.domainRestriction"
                                   placeholder="예: example.com, mysite.com">
                            <div class="form-text">
                                쉼표로 구분하여 여러 도메인 입력 가능. 비어있으면 모든 도메인 허용
                            </div>
                        </div>

                        <!-- 플레이어 선택 -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                <i class="bi bi-play-circle text-primary"></i> 플레이어
                            </label>
                            <select class="form-select" v-model="form.settings.player">
                                <option value="public-v2">공개용 플레이어 v2 (기본)</option>
                                <option value="internal">내부용 플레이어 (로고 워터마크)</option>
                                <option value="partner">파트너용 플레이어</option>
                                <option value="premium">프리미엄 플레이어 (광고 없음)</option>
                            </select>
                        </div>

                        <!-- 플레이어 옵션 -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">플레이어 옵션</label>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="autoplay"
                                               v-model="form.settings.playerOptions.autoplay">
                                        <label class="form-check-label" for="autoplay">
                                            자동 재생
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="controls"
                                               v-model="form.settings.playerOptions.controls">
                                        <label class="form-check-label" for="controls">
                                            컨트롤 표시
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="quality"
                                               v-model="form.settings.playerOptions.qualitySelector">
                                        <label class="form-check-label" for="quality">
                                            화질 선택 가능
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="download"
                                               v-model="form.settings.playerOptions.downloadButton">
                                        <label class="form-check-label" for="download">
                                            다운로드 버튼
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- 외부 배포 -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                <i class="bi bi-share text-primary"></i> 외부 배포
                            </label>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="youtube"
                                       v-model="form.settings.external.youtubeSync">
                                <label class="form-check-label" for="youtube">
                                    <i class="bi bi-youtube text-danger"></i> YouTube 자동 동기화
                                    <span class="text-muted small d-block">패키지 동영상이 YouTube에 자동으로 업로드됩니다</span>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="facebook"
                                       v-model="form.settings.external.facebookSync">
                                <label class="form-check-label" for="facebook">
                                    <i class="bi bi-facebook text-primary"></i> Facebook 동기화
                                </label>
                            </div>
                        </div>

                        <!-- 고급 옵션 (아코디언) -->
                        <div class="accordion" id="advancedOptions">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapseAdvanced">
                                        <i class="bi bi-gear me-2"></i> 고급 옵션 (IP 제한, 지역 제한, DRM 등)
                                    </button>
                                </h2>
                                <div id="collapseAdvanced" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <!-- IP 제한 -->
                                        <div class="mb-3">
                                            <label class="form-label fw-semibold">IP 제한</label>
                                            <textarea class="form-control" rows="2"
                                                      v-model="form.settings.advanced.ipWhitelist"
                                                      placeholder="예: 192.168.1.0/24, 10.0.0.1"></textarea>
                                            <div class="form-text">줄바꿈 또는 쉼표로 구분</div>
                                        </div>

                                        <!-- 지역 제한 -->
                                        <div class="mb-3">
                                            <label class="form-label fw-semibold">지역 제한 (Geo-blocking)</label>
                                            <div class="row g-2">
                                                <div class="col-md-6">
                                                    <input type="text" class="form-control"
                                                           v-model="form.settings.advanced.allowedCountries"
                                                           placeholder="허용 국가: KR, US, JP">
                                                </div>
                                                <div class="col-md-6">
                                                    <input type="text" class="form-control"
                                                           v-model="form.settings.advanced.blockedCountries"
                                                           placeholder="차단 국가: CN">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- DRM -->
                                        <div class="mb-3">
                                            <label class="form-label fw-semibold">DRM 보호</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="drm"
                                                       v-model="form.settings.advanced.drmEnabled">
                                                <label class="form-check-label" for="drm">
                                                    DRM 활성화 (Widevine, FairPlay)
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 템플릿 저장 -->
                        <div class="mt-4 pt-4 border-top">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="saveTemplate"
                                       v-model="saveAsTemplate">
                                <label class="form-check-label" for="saveTemplate">
                                    <i class="bi bi-bookmark"></i> 이 설정을 템플릿으로 저장
                                </label>
                            </div>
                            <div v-if="saveAsTemplate" class="mt-2">
                                <input type="text" class="form-control" v-model="templateName"
                                       placeholder="템플릿 이름 (예: 공개용 설정)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 오른쪽: 미리보기 및 요약 -->
            <div class="col-lg-4">
                <!-- 상태 -->
                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h6 class="mb-0">상태</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">배포 상태</label>
                            <select class="form-select" v-model="form.status">
                                <option value="draft">임시저장</option>
                                <option value="active">활성</option>
                                <option value="inactive">비활성</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 요약 -->
                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h6 class="mb-0">설정 요약</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2">
                                <i class="bi bi-film text-primary"></i>
                                <strong>동영상:</strong> {{form.videos.length}}개
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-shield-check text-primary"></i>
                                <strong>공개:</strong> {{getVisibilityLabel(form.settings.visibility)}}
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-link-45deg text-primary"></i>
                                <strong>도메인:</strong>
                                {{form.settings.domainRestriction || '제한 없음'}}
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-play-circle text-primary"></i>
                                <strong>플레이어:</strong> {{getPlayerLabel(form.settings.player)}}
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-youtube text-danger"></i>
                                <strong>YouTube:</strong>
                                {{form.settings.external.youtubeSync ? '동기화' : '사용 안 함'}}
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- 작업 버튼 -->
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg" :disabled="saving">
                        <span v-if="saving">
                            <span class="spinner-border spinner-border-sm me-2"></span>
                            저장 중...
                        </span>
                        <span v-else>
                            <i class="bi bi-check-lg"></i> {{isEditMode ? '변경사항 저장' : '패키지 생성'}}
                        </span>
                    </button>
                    <button type="button" class="btn btn-outline-secondary" @click="goBack">
                        취소
                    </button>
                </div>
            </div>
        </div>
    </form>

    <!-- 동영상 선택 모달 (간단 버전) -->
    <div class="modal fade" id="videoSelectorModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">동영상 선택</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control mb-3" v-model="videoSearchQuery"
                           placeholder="동영상 검색...">
                    <div class="list-group" style="max-height: 400px; overflow-y: auto">
                        <div v-for="video in availableVideos" :key="video.id"
                             class="list-group-item list-group-item-action"
                             @click="addVideo(video)">
                            <div class="d-flex align-items-center">
                                <img :src="video.thumbnail" class="rounded me-3"
                                     style="width: 80px; height: 60px; object-fit: cover">
                                <div>
                                    <div class="fw-semibold">{{video.title}}</div>
                                    <div class="small text-muted">{{video.duration}} · {{video.views | number}} 조회</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
